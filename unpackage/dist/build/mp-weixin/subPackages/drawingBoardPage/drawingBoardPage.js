"use strict";const t=require("../../common/vendor.js"),e={props:{canvasId:{type:String,default:`th-${Date.now()}`},actionBar:{type:Array,default:()=>["pencli","color","back","clear"]},isDownload:{type:Boolean,default:!0},horizontalScreen:{type:Boolean,default:!1},fileName:{type:String,default:"签名"},delineColor:{type:String,default:"#000"},delineWidth:{type:Number,default:4}},data:()=>({context:"",actionShow:!0,history:[],lineColor:"#000",lineWidth:4,canvasShow:!0,bottomHeight:0}),components:{thColor:()=>"./th-color.js",thLine:()=>"./th-line.js"},mounted(){this.getIphoneBottom(),this.lineColor=this.delineColor,this.lineWidth=this.delineWidth;const e=t.index.createCanvasContext(this.canvasId,this);this.context=e},methods:{getIphoneBottom(){t.index.getSystemInfo({success:t=>{const e=t.screenHeight-t.safeArea.bottom;this.bottomHeight=e>0?e-10:e}})},judge(t){return!!this.actionBar.includes(t)},openAction(t){this.canvasShow=!1,this.$refs[t].checkModel()},setColor(t){this.lineColor=t},setLine(t){this.lineWidth=t},checkAction(){this.actionShow=!this.actionShow},async saveCanvas(){const e=await this.canvasToFilPath();return!!this.isDownload&&new Promise(((o,n)=>{t.index.saveImageToPhotosAlbum({filePath:e,success(e){t.index.showToast({title:"成功保存画板到相册",icon:"success",success:function(t){},fail:function(t){}}),o(e)},fail(t){console.log("err:",t),n(t)}})}))},canvasToFilPath(e={}){return new Promise(((e,o)=>{t.index.canvasToTempFilePath({canvasId:this.canvasId,success:t=>{e(t.tempFilePath)},fail:t=>{o(t)}},this)}))},goBack(){this.context.draw(),this.history.pop(),this.history.forEach(((t,e)=>{let{color:o,width:n}=t.style;if(this.context.beginPath(),this.context.setLineCap("round"),this.context.setStrokeStyle(o),this.context.setLineWidth(n),t.coordinates.length>=2)t.coordinates.forEach((t=>{"touchstart"==t.type?this.context.moveTo(t.x,t.y):this.context.lineTo(t.x,t.y)}));else{const e=t.coordinates[0];this.context.moveTo(e.x,e.y),this.context.lineTo(e.x+1,e.y)}this.context.stroke()})),this.context.draw(!0)},clear(){this.history=[],this.context.draw()},canvasStart(t){let{x:e,y:o}=t.touches[0];this.history.push({style:{color:this.lineColor,width:this.lineWidth},coordinates:[{type:t.type,x:e,y:o}]}),this.drawGraphics()},canvasMove(t){let{x:e,y:o}=t.touches[0];this.history[this.history.length-1].coordinates.push({type:t.type,x:e,y:o}),this.drawGraphics()},drawGraphics(){let t=this.history.length;if(!t)return;let e,o,n=this.history[t-1],s=n.coordinates;if(!s.length)return;s.length<2?(e=s[s.length-1],o={x:e.x+1,y:e.y}):(e=s[s.length-2],o=s[s.length-1]);let i=n.style;this.context.beginPath(),this.context.setLineCap("round"),this.context.setStrokeStyle(i.color),this.context.setLineWidth(i.width),this.context.moveTo(e.x,e.y),this.context.lineTo(o.x,o.y),this.context.stroke(),this.context.draw(!0)}}};if(!Array){(t.resolveComponent("th-color")+t.resolveComponent("th-line"))()}const o=t._export_sfc(e,[["render",function(e,o,n,s,i,a){return t.e({a:0==i.history.length},0==i.history.length?{b:t.n(n.horizontalScreen?"rote-text":"")}:{},{c:i.canvasShow,d:i.canvasShow?"":1,e:n.canvasId,f:n.canvasId,g:t.o((t=>a.canvasStart(t))),h:t.o((t=>a.canvasMove(t))),i:!i.canvasShow,j:i.canvasShow?1:"",k:n.horizontalScreen?1:"",l:a.judge("pencli")},a.judge("pencli")?{m:t.o((t=>a.openAction("thLine")))}:{},{n:a.judge("color")},a.judge("color")?{o:t.o((t=>a.openAction("thColor")))}:{},{p:a.judge("back")},a.judge("back")?{q:t.o(((...t)=>a.goBack&&a.goBack(...t)))}:{},{r:a.judge("clear")},a.judge("clear")?{s:t.o(((...t)=>a.clear&&a.clear(...t)))}:{},{t:t.o(((...t)=>a.saveCanvas&&a.saveCanvas(...t))),v:t.n(n.horizontalScreen?"rote-action":""),w:t.sr("thColor","506fcb6b-0"),x:t.o(a.setColor),y:t.o((t=>i.canvasShow=!0)),z:t.sr("thLine","506fcb6b-1"),A:t.o(a.setLine),B:t.o((t=>i.canvasShow=!0)),C:i.bottomHeight+"px"})}],["__scopeId","data-v-506fcb6b"]]);wx.createPage(o);
