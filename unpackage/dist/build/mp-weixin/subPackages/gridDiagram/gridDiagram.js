"use strict";const e=require("../../common/vendor.js"),t=require("../../store/index.js"),i={data:()=>({isShowPhoto:!1,isSection:!1,imageWidth:0,imageHeight:0,itemWidth:0,itemHeight:0}),methods:{getPhoto(){let i=this;i.isShowPhoto=!1,i.isSection=!1,e.index.chooseImage({sourceType:["album","camera"],count:1,success:function(a){e.index.getImageInfo({src:a.tempFilePaths[0],success:function(s){let o=t.store.getters.screenWidth,h=t.store.getters.screenHeight;if(i.imageWidth=s.width,i.imageHeight=s.height,i.imageWidth>o){const e=o/i.imageWidth;i.imageWidth=o,i.imageHeight*=e}if(i.imageHeight>h){const e=h/i.imageHeight;i.imageHeight=h,i.imageWidth*=e}i.imageHeight=Number(i.imageHeight.toFixed(0)),i.imageWidth=Number(i.imageWidth.toFixed(0)),i.itemWidth=Number((i.imageWidth/3).toFixed(0)),i.itemHeight=Number((i.imageHeight/3).toFixed(0)),i.isShowPhoto=!0,setTimeout((()=>{const t=e.index.createCanvasContext("mycnavas");t.drawImage(a.tempFilePaths[0],0,0,i.imageWidth,i.imageHeight),t.draw()}),300)}})},fail:e=>{}})},async newphoto(){const t=e.index.createCanvasContext("mycnavas");this.isSection=!0;let i=[];for(let e=0;e<3;e++)for(let a=0;a<3;a++){let s=3*e+a;i.push(this.getImageData(t,a,e,s))}await Promise.all(i)},async getImageData(t,i,a,s){let o=this;return new Promise(((h,n)=>{e.index.canvasGetImageData({canvasId:"mycnavas",x:i*o.itemWidth,y:a*o.itemHeight,width:o.itemWidth,height:o.itemHeight,success:async e=>{await this.putImageData(t,e.data,s),await this.canvasToTempFilePath(t,s),h()},fail(e){console.log("fail:",e)}})}))},async putImageData(t,i,a){let s=this;return new Promise(((t,o)=>{e.index.canvasPutImageData({data:i,canvasId:"img"+a,x:0,y:0,width:s.itemWidth,height:s.itemHeight,success:()=>{t()}})}))},async canvasToTempFilePath(t,i){let a=this;return new Promise(((t,s)=>{e.index.canvasToTempFilePath({canvasId:"img"+i,destWidth:a.itemWidth,destHeight:a.itemHeight,success:e=>{t()}})}))},async saveCanvas(){for(let t=0;t<9;t++){let i="img"+t;const a=await this.canvasToFilPath(i);await new Promise(((i,s)=>{e.index.saveImageToPhotosAlbum({filePath:a,success(a){8==t&&e.index.showToast({title:"成功保存切图到相册",icon:"success",success:function(e){},fail:function(e){}}),i(a)},fail(e){s(e)}})}))}},async canvasToFilPath(t){return new Promise(((i,a)=>{e.index.canvasToTempFilePath({canvasId:t,success:e=>{i(e.tempFilePath)},fail:e=>{a(e)}},this)}))}}};const a=e._export_sfc(i,[["render",function(t,i,a,s,o,h){return e.e({a:e.o(((...e)=>t.cancas&&t.cancas(...e))),b:o.imageWidth+"px",c:o.imageHeight+"px",d:o.isShowPhoto&&!o.isSection?"0":"-900px",e:o.isShowPhoto&&!o.isSection?"":"fixed",f:e.f(9,((e,t,i)=>({a:t,b:"img"+t}))),g:o.itemWidth+"px",h:o.itemHeight+"px",i:o.isSection,j:e.o(((...e)=>h.getPhoto&&h.getPhoto(...e))),k:o.isShowPhoto&&!o.isSection},o.isShowPhoto&&!o.isSection?{l:e.o(((...e)=>h.newphoto&&h.newphoto(...e)))}:{},{m:o.isSection},o.isSection?{n:e.o(((...e)=>h.saveCanvas&&h.saveCanvas(...e)))}:{},{o:o.isShowPhoto||o.isSection?"":"center",p:o.isShowPhoto||o.isSection?"":"100vh"})}]]);wx.createPage(a);
